---
layout: post
read_time: true
show_date: true
title: "Linux网络虚拟化"
date: 2015-10-07
img: posts/20210420/post8-rembrandt.jpg
tags: [网络虚拟化]
category: opinion
author: Bobo Du
description: "网络虚拟化"
---
## 网络虚拟化的基石
### Namespace
而且准确的说是Network Namespace。
因为它真的很重要，毫不夸张的说，它是整个云计算领域网络虚拟化技术的基石。顾名思义，Linux的namespace直接翻译过来就是"名字空间"，它的根本作用就是
"隔离资源"。

到底隔离啥资源呢？
隔离的就是我们经常看到的，用到的以下资源：
文件系统挂载点、主机名、POSIX进程间通信、进程PID资源、网络（IP地址，路由，协议栈，网络设备）、用户等全局资源。namespace技术把这些资源分割到了
一个个抽象的独立空间里。而隔离他们用的具体隔离技术就是：Mount namespace、UTS namespace、IPC namespace、PID namesapce、network 
namespace和user namespace。

那么，你要用到哪个namespace里的资源，就要进入相应的ns（namespace）里去。比如对进程来说，要想使用namespace里的资源，首先就要
"进入"（后文介绍操作）到整个namespace去进行访问。

这样一个PID namespace给Linux的进程造成了几个错觉：

    (1)我是系统里唯一的进程。
    
    (2)我独享系统的所有资源。


默认情况下，Linux系统里的进程处于和宿主机相同的系统默认的namespace当中，也就是初始的根namespace里，整个ns默认享有系统全局所有资源。

这种技术什么时候引入的？
我们可以看到，Linux内核从2.4.19版本开始接入第一个namespace的支持：Mount namespace（用于隔离文件系统挂载点）起，到了Linux 内核3.8版本引入
的user namespace（用于隔离用户资源的），总共实现了上文提到的6种不同类型的namespace。

这么好的东西，又是如何进入大众视野的呢？
虽然Linux的namespace技术引入的也比较早了，但是一直鲜为人知。直到前些年一个新星产品的出现，才引领了整个新的技术时代：它就是Docker，它直接引领了
容器技术的革命爆发，是的普罗大众开始进入ns的世界，Docker用的资源隔离技术就是Linux内核提供的namespace技术。

我们这里要说的是网络 namespace，它是从Linux内核2。6版本才引入的，作用很明显，隔离网络设备，以及IP地址、端口，路由表，防火墙等网络资源。也就说，
在整个namespace里，有自己的网络设备（比如IP地址、端口范围、路由表信息，/proc/net资源等）。从容器网络的角度来讲，每个容器都有自己的网络设备，
并且容器里的进程可以安全的绑定在端口上而不用担心资源冲突，这就可以使一个主机上同时监听多个80端口的服务成为可能。


![ns demo](./assets/img/posts/network/ns示意图.jpg)
